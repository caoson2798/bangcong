<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4CAF50">
    <meta name="application-name" content="QL ·∫¢nh V6">
    <meta name="apple-mobile-web-app-title" content="QL ·∫¢nh V6">

    <title>Qu·∫£n L√Ω ·∫¢nh Editor V6 (Edit/Delete)</title>
    <style>
        /* GI·ªÆ NGUY√äN CSS C≈® */
        :root { --primary: #4CAF50; --secondary: #2196F3; --bg: #f4f4f9; --text: #333; --card-bg: #fff; --danger: #f44336; }
        * { -webkit-tap-highlight-color: transparent; user-select: none; }
        input { user-select: text; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 0; height: 100vh; padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom); display: flex; flex-direction: column; overflow: hidden; }
        #splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #11998e, #38ef7d); display: flex; justify-content: center; align-items: center; z-index: 9999; color: white; font-size: 2rem; font-weight: bold; text-align: center; padding: 20px; box-sizing: border-box; transition: opacity 1s ease-out; }
        header { background-color: var(--primary); color: white; padding: 15px; text-align: center; font-weight: bold; font-size: 1.1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; height: 50px; flex-shrink: 0; }
        .header-btn { background: rgba(255,255,255,0.2); border: none; color: white; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-size: 0.9rem; }
        .container { flex: 1; padding: 15px; overflow-y: auto; -webkit-overflow-scrolling: touch; padding-bottom: 100px; }
        .day-card, .history-card { background: var(--card-bg); padding: 15px; margin-bottom: 10px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: transform 0.1s; }
        .day-card:active { transform: scale(0.98); background: #eee; }
        .day-title { font-weight: bold; font-size: 1.1rem; }
        .highlight { color: var(--primary); font-weight: bold; }
        .job-item { background: white; padding: 15px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 5px; }
        /* Update Header Job ƒë·ªÉ ch·ª©a n√∫t s·ª≠a x√≥a */
        .job-header { font-weight: bold; color: #555; border-bottom: 1px solid #eee; padding-bottom: 8px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center;}
        .job-content { display: flex; justify-content: space-between; align-items: center; font-size: 1.1rem; }
        .empty-state { text-align: center; color: #888; margin-top: 50px; }
        .footer-summary { background: white; padding: 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; z-index: 10; flex-shrink: 0; padding-bottom: calc(15px + env(safe-area-inset-bottom)); }
        .btn { padding: 12px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; font-size: 1rem; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-secondary { background-color: var(--secondary); color: white; }
        .btn-danger { background-color: var(--danger); color: white; }
        .fab { position: fixed; bottom: 30px; bottom: calc(30px + env(safe-area-inset-bottom)); right: 20px; width: 60px; height: 60px; background-color: var(--primary); color: white; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 2rem; box-shadow: 0 4px 10px rgba(0,0,0,0.3); cursor: pointer; border: none; z-index: 100; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: white; padding: 20px; border-radius: 10px; width: 85%; max-width: 350px; animation: popUp 0.2s ease-out; }
        @keyframes popUp { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input { width: 100%; padding: 12px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 5px; font-size: 1.1rem; }
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px; }
        .hidden { display: none !important; }
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 1.1rem; }
        
        /* Loading Indicator */
        #sync-status { position: fixed; top: 60px; right: 10px; font-size: 0.7rem; background: rgba(0,0,0,0.5); color: white; padding: 2px 6px; border-radius: 4px; pointer-events: none; z-index: 2000;}

        /* Style cho n√∫t s·ª≠a x√≥a nh·ªè */
        .action-btn { font-size: 0.8rem; padding: 4px 8px; border-radius: 4px; border: none; cursor: pointer; margin-left: 5px; }
        .btn-edit { background: #e3f2fd; color: #2196F3; }
        .btn-del { background: #ffebee; color: #f44336; }
    </style>
</head>
<body>
    <div id="splash-screen" class="hidden">NG√ÄY M·ªöI NHI·ªÄU TI·ªÄN</div>
    <div id="sync-status">ƒêang k·∫øt n·ªëi...</div>

    <div id="screen-home" style="display: flex; flex-direction: column; height: 100%;">
        <header>
            <div style="width: 70px;"></div>
            <div>Th·ªëng K√™ Tu·∫ßn</div>
            <button class="header-btn" onclick="openHistory()">L·ªãch s·ª≠</button>
        </header>
        <div class="container" id="week-list"></div>
        <div class="footer-summary" style="flex-direction: column; align-items: flex-start;">
            <div style="width: 100%; display:flex; justify-content:space-between; margin-bottom: 5px;">
                <span>T·ªïng th√°ng hi·ªán t·∫°i:</span><b id="month-qty">...</b>
            </div>
            <div style="width: 100%; display:flex; justify-content:space-between;">
                <span>Doanh thu:</span><b id="month-money" style="color: var(--primary); font-size: 1.2rem;">...</b>
            </div>
            <div style="width: 100%; margin-top: 10px; display: flex; gap: 10px;">
                <button class="btn btn-secondary" style="flex:1" onclick="showWeekSummary()">Ch·ªët Tu·∫ßn</button>
            </div>
        </div>
    </div>

    <div id="screen-detail" class="hidden" style="display: flex; flex-direction: column; height: 100%;">
        <header>
            <button class="header-btn" onclick="goHome()">&#8592; Quay l·∫°i</button>
            <div id="detail-title">Th·ª© ...</div>
            <div style="width: 80px;"></div>
        </header>
        <div class="container" id="job-list"></div>
        <div class="footer-summary">
            <div>T·ªïng ·∫£nh: <span id="day-qty">0</span><br>T·ªïng ti·ªÅn: <span id="day-money" class="highlight">0 ƒë</span></div>
        </div>
        <button class="fab" onclick="openAddJobModal()">+</button>
    </div>

    <div id="screen-history" class="hidden" style="display: flex; flex-direction: column; height: 100%;">
        <header>
            <button class="header-btn" onclick="goHome()">&#8592; Quay l·∫°i</button>
            <div>L·ªãch S·ª≠ Doanh Thu</div>
            <div style="width: 70px;"></div>
        </header>
        <div class="container" id="history-list">
            <div class="empty-state">Ch∆∞a c√≥ d·ªØ li·ªáu l·ªãch s·ª≠.</div>
        </div>
        <div style="padding: 20px; text-align: center; background: #eee;">
            <button class="btn btn-danger" style="width: 100%; opacity: 0.8;" onclick="factoryReset()">‚ö†Ô∏è X√ìA S·∫†CH D·ªÆ LI·ªÜU (Factory Reset)</button>
        </div>
    </div>

    <div id="modal-add-job" class="modal">
        <div class="modal-content">
            <h3 id="modal-job-title">Th√™m Job M·ªõi</h3>
            <div class="form-group"><label>S·ªë l∆∞·ª£ng ·∫£nh:</label><input type="tel" id="input-qty" placeholder="Nh·∫≠p s·ªë l∆∞·ª£ng" inputmode="numeric"></div>
            <div class="form-group"><label>ƒê∆°n gi√° (VNƒê):</label><input type="text" id="input-price" value="10.000" inputmode="numeric" oninput="formatInputMoney(this)"></div>
            <div class="modal-actions"><button class="btn" onclick="closeModal('modal-add-job')">H·ªßy</button><button class="btn btn-primary" onclick="saveJob()">L∆∞u</button></div>
        </div>
    </div>

    <div id="modal-summary" class="modal">
        <div class="modal-content">
            <h3 style="text-align: center; color: var(--secondary);">T·ªïng K·∫øt Tu·∫ßn</h3>
            <div class="stat-row"><span>T·ªïng ·∫£nh:</span><b id="summary-qty">0</b></div>
            <div class="stat-row"><span>Doanh thu:</span><b id="summary-money" class="highlight">0 ƒë</b></div>
            <hr>
            <p style="font-size: 0.9rem; color: #666;">Reset s·∫Ω c·ªông d·ªìn s·ªë li·ªáu v√†o th√°ng v√† x√≥a s·∫°ch tu·∫ßn n√†y ƒë·ªÉ l√†m tu·∫ßn m·ªõi.</p>
            <div class="modal-actions" style="justify-content: space-between;"><button class="btn btn-danger" onclick="resetWeek()">Reset Tu·∫ßn</button><button class="btn" onclick="closeModal('modal-summary')">ƒê√≥ng</button></div>
        </div>
    </div>

    <div id="modal-month-end" class="modal">
        <div class="modal-content">
            <h3 style="text-align: center; color: var(--primary);">üéâ Ch√∫c M·ª´ng Th√°ng M·ªõi!</h3>
            <p>Th√°ng <b><span id="prev-month-name"></span></b> m√†y ƒë√£ l√†m ƒë∆∞·ª£c:</p>
            <div class="stat-row"><span>T·ªïng ·∫£nh:</span><b id="end-month-qty">0</b></div>
            <div class="stat-row"><span>Doanh thu:</span><b id="end-month-money" class="highlight">0 ƒë</b></div>
            <hr>
            <p style="font-size: 0.9rem; color: #666;">D·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c l∆∞u v√†o m·ª•c "L·ªãch s·ª≠". H·ªá th·ªëng s·∫Ω reset ƒë·ªÉ t√≠nh th√°ng m·ªõi.</p>
            <button class="btn btn-primary" style="width: 100%" onclick="closeModal('modal-month-end')">OK, Chi·∫øn th√°ng m·ªõi!</button>
        </div>
    </div>

    <script type="module">
        // ------------------------------------------------------------------
        // D√ÅN L·∫†I CONFIG C·ª¶A M√ÄY V√ÄO ƒê√ÇY
        // ------------------------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyA97Yk8o9lPZmD_TcFtpVM4tN3isCapLmc",
            authDomain: "bangcong-f689c.firebaseapp.com",
            projectId: "bangcong-f689c",
            storageBucket: "bangcong-f689c.firebasestorage.app",
            messagingSenderId: "49250279708",
            appId: "1:49250279708:web:267d7e391040940b069ad9",
            measurementId: "G-GNS9TC8C8X"
        };
        // ------------------------------------------------------------------

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        let app, db, docRef;

        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            docRef = doc(db, "apps", "photo_editor_user");
        } catch (e) {
            console.error("L·ªói Config!", e);
            document.getElementById('sync-status').innerText = "L·ªói Config!";
            document.getElementById('sync-status').style.background = "red";
        }

        const DAYS = ["Th·ª© 2", "Th·ª© 3", "Th·ª© 4", "Th·ª© 5", "Th·ª© 6", "Th·ª© 7"];
        let currentDayIndex = null;
        let editingJobIndex = null; // Bi·∫øn ƒë·ªÉ bi·∫øt ƒëang s·ª≠a job n√†o
        
        let data = {
            currentMonthStr: "", 
            weekJobs: { 0: [], 1: [], 2: [], 3: [], 4: [], 5: [] },
            monthlyStats: { qty: 0, money: 0 },
            history: [] 
        };

        // --- H√ÄM TO√ÄN C·ª§C ---
        window.openDetail = (idx) => { currentDayIndex = idx; updateDetailView(); toggleScreen('screen-detail'); };
        window.goHome = () => { toggleScreen('screen-home'); };
        window.openHistory = () => { renderHistory(); toggleScreen('screen-history'); };
        window.openAddJobModal = () => { 
            editingJobIndex = null; // Reset tr·∫°ng th√°i s·ª≠a
            document.getElementById('modal-job-title').innerText = "Th√™m Job M·ªõi";
            document.getElementById('input-qty').value = ''; 
            // document.getElementById('input-price').value = '10.000'; // Gi·ªØ nguy√™n gi√° c≈© n·∫øu mu·ªën
            showModal('modal-add-job'); 
            document.getElementById('input-qty').focus(); 
        };
        window.closeModal = (id) => { document.getElementById(id).style.display = 'none'; };
        window.saveJob = saveJobLogic;
        window.showWeekSummary = showWeekSummaryLogic;
        window.resetWeek = resetWeekLogic;
        window.formatInputMoney = formatInputMoneyLogic;
        window.factoryReset = factoryResetLogic;
        
        // H√†m m·ªõi: S·ª≠a & X√≥a
        window.editJob = (idx) => {
            editingJobIndex = idx;
            const job = data.weekJobs[currentDayIndex][idx];
            document.getElementById('modal-job-title').innerText = "S·ª≠a Job " + (idx + 1);
            document.getElementById('input-qty').value = job.qty;
            document.getElementById('input-price').value = new Intl.NumberFormat('vi-VN').format(job.price);
            showModal('modal-add-job');
        };

        window.deleteJob = (idx) => {
            if(confirm("C√≥ ch·∫Øc ch·∫Øn x√≥a Job n√†y kh√¥ng?")) {
                data.weekJobs[currentDayIndex].splice(idx, 1);
                saveDataCloud();
            }
        };

        // --- CORE SYNC ---
        function init() {
            if(docRef) {
                onSnapshot(docRef, (docSnapshot) => {
                    const statusEl = document.getElementById('sync-status');
                    statusEl.innerText = "ƒê√£ ƒë·ªìng b·ªô";
                    statusEl.style.background = "#4CAF50";
                    setTimeout(() => statusEl.style.display = 'none', 2000);

                    if (docSnapshot.exists()) {
                        data = docSnapshot.data();
                        checkMonthChange();
                        renderHome();
                        updateMonthStatsUI();
                        if(!document.getElementById('screen-detail').classList.contains('hidden')) renderJobs();
                        if(!document.getElementById('screen-history').classList.contains('hidden')) renderHistory();
                    } else {
                        const now = new Date();
                        data = {
                            currentMonthStr: `${now.getMonth() + 1}/${now.getFullYear()}`,
                            weekJobs: { 0: [], 1: [], 2: [], 3: [], 4: [], 5: [] },
                            monthlyStats: { qty: 0, money: 0 },
                            history: []
                        };
                        saveDataCloud();
                    }
                    checkSplash();
                }, (error) => {
                    document.getElementById('sync-status').innerText = "M·∫•t k·∫øt n·ªëi";
                    document.getElementById('sync-status').style.background = "red";
                    document.getElementById('sync-status').style.display = 'block';
                });
            }
        }

        function saveDataCloud() {
            const statusEl = document.getElementById('sync-status');
            statusEl.style.display = 'block';
            statusEl.innerText = "ƒêang l∆∞u...";
            statusEl.style.background = "#FF9800";
            setDoc(docRef, data).catch((e) => alert("L·ªói l∆∞u: " + e.message));
        }

        // --- LOGIC GIAO DI·ªÜN ---
        function formatMoney(amount) { return new Intl.NumberFormat('vi-VN').format(amount) + ' ƒë'; }
        function getRawNumber(str) { return parseInt(str.replace(/\./g, '')) || 0; }
        function formatInputMoneyLogic(input) { let val = input.value.replace(/\D/g, ''); input.value = val ? new Intl.NumberFormat('vi-VN').format(val) : ''; }

        function checkSplash() {
            const today = new Date().toDateString();
            if (localStorage.getItem('lastOpenDate') !== today) {
                const splash = document.getElementById('splash-screen');
                splash.classList.remove('hidden');
                setTimeout(() => { splash.style.opacity = '0'; setTimeout(() => splash.classList.add('hidden'), 1000); }, 2000);
                localStorage.setItem('lastOpenDate', today);
            }
        }

        function checkMonthChange() {
            const now = new Date();
            const thisMonthKey = `${now.getMonth() + 1}/${now.getFullYear()}`;
            if (data.currentMonthStr && data.currentMonthStr !== thisMonthKey) {
                if (data.monthlyStats.qty > 0) {
                    data.history.unshift({ month: data.currentMonthStr, qty: data.monthlyStats.qty, money: data.monthlyStats.money });
                    document.getElementById('prev-month-name').innerText = data.currentMonthStr;
                    document.getElementById('end-month-qty').innerText = data.monthlyStats.qty;
                    document.getElementById('end-month-money').innerText = formatMoney(data.monthlyStats.money);
                    showModal('modal-month-end');
                }
                data.monthlyStats = { qty: 0, money: 0 };
                data.currentMonthStr = thisMonthKey;
                saveDataCloud();
            } else if (!data.currentMonthStr) {
                 data.currentMonthStr = thisMonthKey;
                 saveDataCloud();
            }
        }

        function renderHome() {
            const list = document.getElementById('week-list');
            list.innerHTML = '';
            DAYS.forEach((dayName, index) => {
                const jobs = data.weekJobs[index] || [];
                const totalQty = jobs.reduce((sum, job) => sum + job.qty, 0);
                const totalMoney = jobs.reduce((sum, job) => sum + (job.qty * job.price), 0);
                const div = document.createElement('div');
                div.className = 'day-card';
                div.innerHTML = `<span class="day-title">${dayName}</span><div style="text-align:right"><div style="font-weight:bold">${totalQty} ·∫£nh</div><div style="font-size:0.8rem; color:#666">${formatMoney(totalMoney)}</div></div>`;
                div.onclick = () => window.openDetail(index);
                list.appendChild(div);
            });
        }

        function renderJobs() {
            const list = document.getElementById('job-list'); list.innerHTML = '';
            const jobs = data.weekJobs[currentDayIndex];
            let totalQty = 0; let totalMoney = 0;
            if (jobs.length === 0) { list.innerHTML = '<div class="empty-state">Ch∆∞a c√≥ job n√†o.<br>·∫§n d·∫•u + ƒë·ªÉ th√™m.</div>'; } 
            else {
                jobs.forEach((job, idx) => {
                    totalQty += job.qty; totalMoney += job.qty * job.price;
                    const div = document.createElement('div'); div.className = 'job-item';
                    div.innerHTML = `
                        <div class="job-header">
                            Job ${idx + 1}
                            <div>
                                <button class="action-btn btn-edit" onclick="editJob(${idx})">S·ª≠a</button>
                                <button class="action-btn btn-del" onclick="deleteJob(${idx})">X√≥a</button>
                            </div>
                        </div>
                        <div class="job-content"><span>${job.qty} ·∫£nh</span><span class="highlight">${formatMoney(job.qty * job.price)}</span></div>
                    `;
                    list.appendChild(div);
                });
            }
            document.getElementById('day-qty').innerText = totalQty;
            document.getElementById('day-money').innerText = formatMoney(totalMoney);
        }

        function updateDetailView() { document.getElementById('detail-title').innerText = DAYS[currentDayIndex]; renderJobs(); }
        function updateMonthStatsUI() { document.getElementById('month-qty').innerText = data.monthlyStats.qty + " ·∫£nh"; document.getElementById('month-money').innerText = formatMoney(data.monthlyStats.money); }
        
        function toggleScreen(showId) {
            ['screen-home', 'screen-detail', 'screen-history'].forEach(id => {
                const el = document.getElementById(id);
                if (id === showId) { el.classList.remove('hidden'); el.querySelector('.container').scrollTop = 0; } 
                else { el.classList.add('hidden'); }
            });
        }

        function renderHistory() {
            const list = document.getElementById('history-list'); list.innerHTML = '';
            if(data.history.length === 0) { list.innerHTML = '<div class="empty-state">Ch∆∞a c√≥ d·ªØ li·ªáu th√°ng c≈©.</div>'; return; }
            data.history.forEach(item => {
                const div = document.createElement('div'); div.className = 'history-card';
                div.innerHTML = `<span class="day-title">Th√°ng ${item.month}</span><div style="text-align:right"><div>${item.qty} ·∫£nh</div><div class="highlight">${formatMoney(item.money)}</div></div>`;
                list.appendChild(div);
            });
        }

        function saveJobLogic() {
            const qty = parseInt(document.getElementById('input-qty').value);
            const price = getRawNumber(document.getElementById('input-price').value);
            if (!qty || qty <= 0) { alert("Nh·∫≠p s·ªë l∆∞·ª£ng ·∫£nh ƒëi m√†y ∆°i!"); return; }
            if (!price || price < 0) { alert("Gi√° ti·ªÅn kh√¥ng ƒë√∫ng!"); return; }
            
            if (editingJobIndex !== null) {
                // ƒêang s·ª≠a
                data.weekJobs[currentDayIndex][editingJobIndex] = { qty, price };
            } else {
                // Th√™m m·ªõi
                data.weekJobs[currentDayIndex].push({ qty, price });
            }
            
            saveDataCloud();
            window.closeModal('modal-add-job');
        }

        function showWeekSummaryLogic() {
            let weekQty = 0; let weekMoney = 0;
            for (let i = 0; i < 6; i++) { data.weekJobs[i].forEach(job => { weekQty += job.qty; weekMoney += job.qty * job.price; }); }
            document.getElementById('summary-qty').innerText = weekQty;
            document.getElementById('summary-money').innerText = formatMoney(weekMoney);
            showModal('modal-summary');
        }

        function resetWeekLogic() {
            if(!confirm("Ch·ªët tu·∫ßn nh√©? D·ªØ li·ªáu s·∫Ω c·ªông v√†o th√°ng v√† x√≥a tu·∫ßn c≈©.")) return;
            let weekQty = 0; let weekMoney = 0;
            for (let i = 0; i < 6; i++) { data.weekJobs[i].forEach(job => { weekQty += job.qty; weekMoney += job.qty * job.price; }); data.weekJobs[i] = []; }
            data.monthlyStats.qty += weekQty; data.monthlyStats.money += weekMoney;
            saveDataCloud();
            window.closeModal('modal-summary');
            window.goHome();
        }
        
        async function factoryResetLogic() {
            if(!confirm("‚ö†Ô∏è C·∫¢NH B√ÅO: M√†y c√≥ ch·∫Øc ch·∫Øn mu·ªën X√ìA TO√ÄN B·ªò d·ªØ li·ªáu kh√¥ng?\n\n- T·∫•t c·∫£ l·ªãch s·ª≠ c√°c th√°ng c≈© s·∫Ω m·∫•t.\n- D·ªØ li·ªáu tu·∫ßn n√†y s·∫Ω m·∫•t.\n- T·ªïng ti·ªÅn s·∫Ω v·ªÅ 0.\n\nKh√¥ng kh√¥i ph·ª•c ƒë∆∞·ª£c ƒë√¢u nh√©!")) return;
            if(!confirm("H·ªèi l·∫°i l·∫ßn n·ªØa: TH·∫¨T S·ª∞ MU·ªêN X√ìA S·∫†CH √Ä?")) return;

            const now = new Date();
            const emptyData = {
                currentMonthStr: `${now.getMonth() + 1}/${now.getFullYear()}`,
                weekJobs: { 0: [], 1: [], 2: [], 3: [], 4: [], 5: [] },
                monthlyStats: { qty: 0, money: 0 },
                history: []
            };

            try {
                await setDoc(docRef, emptyData);
                alert("ƒê√£ x√≥a tr·∫Øng d·ªØ li·ªáu th√†nh c√¥ng! L√†m l·∫°i cu·ªôc ƒë·ªùi.");
                toggleScreen('screen-home');
            } catch (e) {
                alert("L·ªói khi x√≥a: " + e.message);
            }
        }

        function showModal(id) { document.getElementById(id).style.display = 'flex'; }
        window.onclick = function(e) { if (e.target.classList.contains('modal')) e.target.style.display = "none"; }

        init();
    </script>
</body>
</html>